# Инструкция пользователя — Production HACCP Control (MVP)

## 1. Назначение системы
Production HACCP Control — это рабочее место для:
- ведения HACCP-журналов (температуры, здоровье персонала)
- работы с регламентами/инструкциями (создание, согласование, ознакомление)
- фиксации несоответствий
- ведения реестра документов
- подготовки к проверкам (аудит-лог)

## 2. Роли и права

### 2.1. Основные роли
- **director** — руководитель (утверждение/подпись, управленческие действия)
- **accountant** — бухгалтерия (участие в маршрутах, просмотр)
- **head** — руководитель производства (создание регламентов, управление исполнением)
- **employee** — сотрудник (исполнение задач, журналы — в рамках доступных разделов)
- **journals_admin** — администратор журналов (ведение журналов)

### 2.2. Роли «только просмотр»
- **auditor** — только просмотр
- **technologist** — только просмотр

Для ролей «только просмотр» любые действия записи запрещены:
- в интерфейсе кнопки создания/редактирования скрываются или отключаются
- API-методы изменения (POST/PUT/PATCH/DELETE) возвращают **403**

## 3. Раздел «Регламенты / Документы»

### 3.1. Список документов
Путь: `/documents`
- отображаются доступные вам регламенты/инструкции
- можно открыть документ и увидеть этапы согласования, вложения, историю

### 3.2. Создание регламента
Путь: `/documents/new`
Доступно: всем, кроме ролей «только просмотр».

Порядок создания:
1. **Название регламента** — кратко и однозначно (например: «Инструкция по мойке оборудования»)
2. **Текст регламента** — требования, шаги, периодичность, ответственные, контрольные точки
3. **Вложения** — PDF/DOC/XLS/изображения (общий лимит по размеру ограничен)
4. **Маршрут утверждения** — добавьте минимум 1 этап (утверждение/подпись/ознакомление)
5. **Ответственный исполнитель** — сотрудник, который отвечает за внедрение и выполнение

Важно:
- **Первый этап маршрута** становится «получателем» (кому документ приходит в работу на шаг 1)
- «Ответственный исполнитель» фиксируется отдельно как ответственный за выполнение/контроль

После создания документ появляется в системе и становится доступен участникам маршрута.

### 3.3. Работа с задачами по документу
Путь: `/documents/[id]`
- участники маршрута видят свою задачу (шаг, действие, комментарии)
- после выполнения шага документ переходит к следующему участнику

### 3.4. Импорт (оцифровка) существующих документов после внедрения
Если на предприятии уже есть действующие регламенты, инструкции, сертификаты и протоколы, их можно перенести в систему в виде файлов.

Путь: `/documents/import`

Доступно: всем, кроме ролей «только просмотр».

Режимы импорта:
- **Архив (без маршрута)** — система создаст документ сразу как утверждённый (без согласования), прикрепит файл и добавит запись в аудит-лог.
- **Запуск маршрута** — система создаст документ на каждый файл и запустит одинаковый маршрут согласования для всей пачки.

Рекомендуемый порядок переноса:
1. Загрузите документы пачками по смыслу (например: «Сертификаты на сырьё», «Инструкции по санитарии», «Регламенты HACCP»).
2. Для «уже утверждённых» документов используйте режим **Архив**.
3. Для документов, которые нужно пересогласовать/ввести в действие заново, используйте режим **Запуск маршрута**.

Примечание:
- В MVP импорт ориентирован на быстрый перенос файлов. Если нужно автоматическое заполнение реестра (зона/поставщик/срок) — это можно добавить следующим шагом.

## 4. Раздел «Workflow / Входящие»
Путь: `/workflow`

Вкладки:
- **Входящие** — документы, где у вас есть активная задача (ожидает действия)
- **На согласовании** — документы в процессе, где вы уже отработали
- **Архив** — утверждённые/исполненные документы

Создание регламента доступно только для ролей, которым разрешены действия записи.

## 5. Реестр документов
Путь: `/registry`
Назначение:
- ведение реестра (тип объекта, зона/цех, поставщик/производитель, срок действия)
- подготовка пакета документов для проверки

Ограничения:
- роли «только просмотр» не могут добавлять/редактировать записи

## 6. Несоответствия
Путь: `/nonconformities`
Назначение:
- фиксация отклонений/несоответствий
- привязка к документам/регламентам
- контроль статуса (open/closed)

Ограничения:
- роли «только просмотр» не могут создавать/закрывать/переоткрывать

## 7. Журналы (HACCP)
Пути: `/journals/*`

### 7.1. Журнал температур
- фиксация температур по оборудованию
- выделение отклонений относительно нормы/допуска
- формирование PDF (если включено)

### 7.2. Журнал здоровья персонала
- отметки по сотрудникам (здоров/отстранён/отпуск/выходной)
- «подписание смены» (если включено в интерфейсе журнала)

## 8. Telegram (уведомления)
Путь: `/telegram`
- привязка Telegram для получения уведомлений по задачам

Ограничения:
- роли «только просмотр» не могут выполнять привязку/отвязку

## 9. Аудит-лог
Путь: `/audit-log`
- фиксирует ключевые действия (создание документа, изменения статусов и т.д.)
- используется для готовности к проверке и расследования инцидентов

## 10. Частые сценарии

### 10.1. Создать регламент и отправить на утверждение
- `/documents/new` → заполнить → собрать маршрут → выбрать ответственного → создать

### 10.2. Утвердить/подписать/ознакомиться
- `/workflow` → открыть документ → выполнить действие по своему этапу

### 10.3. Подготовить пакет для проверки
- `/registry/package` (или `/registry` + фильтры) → проверить сроки, зоны, поставщиков

---

## Примечания (MVP)
- Система ориентирована на «невозможность тихого редактирования задним числом» (audit-ready подход).
- Роли «auditor/technologist» предназначены для просмотра и проверки, без права внесения изменений.
